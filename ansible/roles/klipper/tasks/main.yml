    - name: start klipper containers from docker-compose file
      community.docker.docker_compose_v2:
        project_src: "{{ role_path }}/files"
        state: present

    - name: Ensure klipper-net network exists
      community.docker.docker_network:
        name: klipper-net
        state: present
    
    - name: Connect nginx container to klipper-net network
      community.docker.docker_network:
        name: klipper-net
        connected:
          - nginx

    - name: Copy klipper.conf into nginx directory
      ansible.builtin.copy:
        src: "{{ role_path }}/files/klipper.conf"
        dest: /opt/nginx/conf.d/klipper.conf
        mode: '0644'

    - name: Reload nginx to apply config
      community.docker.docker_container_exec:
        container: nginx
        command: nginx -s reload