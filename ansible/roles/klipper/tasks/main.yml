- name: Add klipper config to nginx
  include_tasks: ../nginx/tasks/add_service.yml
  vars:
    service_name: klipper
    service_config_path: "{{ role_path }}/files/klipper_nginx.conf"

- name: start klipper containers from docker-compose file
  community.docker.docker_compose_v2:
    project_src: "{{ role_path }}/files"
    state: present

- name: Add Samba share for gcodes
  blockinfile:
    path: /opt/samba/smb.conf
    block: |
      [gcodes]
      path = /opt/printer_data/gcodes
      browseable = yes
      read only = no
      guest ok = no
      valid users = sambauser
      create mask = 0664
      directory mask = 0775
    marker: "# {mark} ANSIBLE MANAGED BLOCK - Klipper"\
  notify: Restart samba
  