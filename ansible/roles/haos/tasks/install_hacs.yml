- name: Check if HACS is already installed
  community.docker.docker_container_exec:
    container: "haos"
    command: test -d /config/custom_components/hacs
  register: hacs_check
  ignore_errors: true

- name: Install HACS if not present
  block:
    - name: Download HACS install script inside container
      docker_container_exec:
        container: "{{ ha_container_name }}"
        command: wget -O /tmp/hacs_install.sh https://get.hacs.xyz

    - name: Run HACS install script inside container
      docker_container_exec:
        container: "{{ ha_container_name }}"
        command: bash /tmp/hacs_install.sh
      register: hacs_install
  when: hacs_check.rc != 0
  

- name: Restart Home Assistant container if HACS was installed
  community.docker.docker_container:
    name: "haos"
    state: restarted
  when: hacs_install is defined and hacs_install.changed